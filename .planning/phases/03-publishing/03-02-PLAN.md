---
phase: 03-publishing
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/[handle]/page.tsx
  - app/[handle]/not-found.tsx
  - app/components/PublicProfile.tsx
  - public/og-image.png
autonomous: true

must_haves:
  truths:
    - "Published page displays at /handle with bio, artists, albums, tracks"
    - "Page shows rich preview when shared (Open Graph metadata)"
    - "Unpublished or non-existent handles show 404 page"
    - "Page is mobile-responsive"
  artifacts:
    - path: "app/[handle]/page.tsx"
      provides: "Public profile page with ISR and generateMetadata"
      exports: ["default", "generateMetadata", "revalidate"]
    - path: "app/[handle]/not-found.tsx"
      provides: "Custom 404 for profile routes"
    - path: "app/components/PublicProfile.tsx"
      provides: "Public profile layout component"
    - path: "public/og-image.png"
      provides: "Generic OG image for social sharing"
  key_links:
    - from: "app/[handle]/page.tsx"
      to: "lib/dynamodb/public-profile.ts"
      via: "getPublicProfile call"
      pattern: "getPublicProfile\\(handle\\)"
    - from: "app/[handle]/page.tsx"
      to: "next/navigation"
      via: "notFound() call"
      pattern: "notFound\\(\\)"
---

<objective>
Create the public profile page at /[handle] with ISR caching and Open Graph metadata for social sharing.

Purpose: This is the core deliverable of Phase 3 - the shareable public page that users publish. It must render correctly on mobile/desktop, show rich previews when shared on WhatsApp/Twitter/LinkedIn, and load fast via ISR caching.

Output:
- Dynamic route at /[handle] with generateMetadata for OG tags
- Custom 404 page for unpublished/non-existent handles
- PublicProfile component with album-first, minimal aesthetic
- Generic OG image (1200x630, under 300KB)
</objective>

<execution_context>
@/Users/mathewbroughton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mathewbroughton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-publishing/03-RESEARCH.md

# Data layer from Plan 01
@lib/dynamodb/public-profile.ts

# Existing UI patterns
@app/components/MusicDataSection.tsx
@app/components/AlbumCaptions.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create public profile page with ISR and metadata</name>
  <files>app/[handle]/page.tsx, app/[handle]/not-found.tsx</files>
  <action>
Create the dynamic route at app/[handle]/page.tsx:

1. Export revalidate = 3600 (ISR: 1 hour cache)

2. Type Props correctly for Next.js 15:
```typescript
type Props = {
  params: Promise<{ handle: string }>
}
```

3. Implement generateMetadata function:
   - Await params to get handle (Next.js 15 breaking change!)
   - Call getPublicProfile(handle)
   - Return empty object if profile is null
   - Return Metadata with:
     - title: "{displayName} on Anchor.band"
     - description: bio text or fallback "Check out {displayName}'s music taste"
     - openGraph: title, description, url (https://anchor.band/{handle}), siteName, images (og-image.png at 1200x630), type: 'profile'
     - twitter: card 'summary_large_image', title, description, images

4. Implement default page component:
   - Await params to get handle
   - Call getPublicProfile(handle)
   - Call notFound() if profile is null (triggers not-found.tsx)
   - Render PublicProfile component with profile data

Create app/[handle]/not-found.tsx:
- Simple, tasteful 404 page
- "Profile Not Found" heading
- "This page doesn't exist or is not published." message
- Link back to home
- Match calm aesthetic (no harsh colors, minimal design)
  </action>
  <verify>`npm run build` succeeds, route compiles without errors</verify>
  <done>Public page at /[handle] renders profile data, returns 404 for unpublished, includes OG metadata</done>
</task>

<task type="auto">
  <name>Task 2: Create PublicProfile layout component</name>
  <files>app/components/PublicProfile.tsx</files>
  <action>
Create a server component for the public profile layout at app/components/PublicProfile.tsx.

Design philosophy from PROJECT.md: "Calm, minimal, album-first aesthetic"

Layout structure:
1. Header section:
   - Display name (large, prominent)
   - Bio text below name

2. Top Artists section:
   - Section heading "Top Artists" (subtle, not shouty)
   - Horizontal scroll or wrapped grid of artist images (circular, like dashboard)
   - Artist names below images
   - 5-6 artists max

3. Albums section (MOST PROMINENT - album-first):
   - Section heading "Albums"
   - Responsive grid: 1 col mobile, 2 cols tablet, 3 cols desktop
   - Each album card:
     - Square album cover image
     - Album name
     - Artist name (smaller)
     - Caption text (if exists)

4. Top Tracks section:
   - Section heading "Top Tracks"
   - Simple numbered list (1. Track - Artist)
   - 3 tracks

Props type:
```typescript
type PublicProfileProps = {
  displayName: string
  bio: string | null
  artists: Artist[]
  albums: Album[]
  tracks: Track[]
  captions: Caption[]
}
```

Styling:
- Use existing Tailwind patterns from dashboard components
- Neutral colors, generous whitespace
- Mobile-first responsive breakpoints
- No hover effects needed (read-only page)
- Subtle section separators

Import types from @/types/music and @/types/content.
Match album to caption by albumId when rendering.
  </action>
  <verify>Component renders without errors, TypeScript compiles</verify>
  <done>PublicProfile component renders all sections with calm, album-first aesthetic, responsive layout</done>
</task>

<task type="auto">
  <name>Task 3: Create generic OG image</name>
  <files>public/og-image.png</files>
  <action>
Create a simple, tasteful OG image for social sharing.

Requirements:
- Dimensions: 1200 x 630 pixels
- File size: Under 300KB (WhatsApp limit)
- Format: PNG

Design:
- Solid neutral background (e.g., #1a1a1a dark or #f5f5f5 light - match site aesthetic)
- "Anchor.band" text centered
- Optionally: tagline "Your music taste, tastefully." smaller below
- Clean, minimal - matches product philosophy

Since this is a static image, create it using a simple approach:
1. Create using CSS-to-image if you have access to a generator
2. Or describe exact specifications for user to create
3. Or create a placeholder that meets size requirements

The image lives at public/og-image.png and is referenced in metadata as https://anchor.band/og-image.png.

For now, create a minimal placeholder image that can be replaced later. Use a bash command with ImageMagick if available, or document what's needed.
  </action>
  <verify>File exists at public/og-image.png, is PNG format, dimensions are 1200x630, file size under 300KB</verify>
  <done>OG image exists at correct path with correct dimensions for social sharing</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm run dev` - navigate to /test-handle shows 404 page
3. Dynamic route files exist:
   - app/[handle]/page.tsx exports revalidate, generateMetadata, default
   - app/[handle]/not-found.tsx renders 404 UI
4. PublicProfile component exists and accepts expected props
5. OG image exists at public/og-image.png with correct dimensions
6. Page uses ISR (revalidate = 3600)
7. Params are awaited (Next.js 15 requirement)
</verification>

<success_criteria>
- Published profiles render at /handle with all content visible
- Unpublished profiles trigger custom 404 page
- Open Graph metadata includes title, description, image
- Page is mobile-responsive (1/2/3 column album grid)
- ISR caching enabled (1 hour revalidation)
- OG image is 1200x630 and under 300KB
</success_criteria>

<output>
After completion, create `.planning/phases/03-publishing/03-02-SUMMARY.md`
</output>
